defmodule InterlineClient.PageController do
  use InterlineClient.Web, :controller

	@code "code"
	@state "state"
	@session_state "session_state"
	
  plug :action

  def index(conn, _params) do
    render conn, "index.html"
  end

	@moduledoc """
  Redirects browser to authenticate  via Azure Active Directory (interlineWebApp). 
  """
	def aad(conn, _params) do
		redirectUri = "https://login.windows.net/common/oauth2/authorize?response_type=code&
                                                       client_id=5f0f5118-45a5-40a2-be35-c59883eb12ca&
                                                       resource=https://graph.windows.net&
                                                       redirect_uri=http://localhost:4000/aad/response&
                                                       state=#{UUID.uuid1()}"
		redirect conn, external: redirectUri
	end
	@moduledoc """
  Callback handler for Azure Active Directory Authentication
  """
	def aad_response(conn, _params) do
		conn = fetch_params(conn) # populates conn.params
		%{@code => code, @state => state, @session_state => session_state} = conn.params
		send_resp(conn,"200","User Logged In with Code:#{code}, State: #{state}, Session_State: #{session_state}")
	end
end
